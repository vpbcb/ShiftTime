<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Расчет смены</title>

<link rel="manifest" href="manifest.json">

<style>
body { margin:0; background:#f6f7f9; font-family:Arial, sans-serif; }
.wrap { max-width:720px; margin:auto; padding:14px; }
.card { background:#fff; border:1px solid #e6e8ee; border-radius:12px; padding:12px; margin-bottom:10px; }
h1 { font-size:20px; margin:0; }

.row { display:grid; grid-template-columns:1fr; gap:10px; }
@media (min-width:640px){ .row.two { grid-template-columns:1fr 1fr; } }

/* держим 2 колонки даже на телефоне */
.row.keepTwo{
  grid-template-columns:1fr 1fr;
  align-items:end;
}
@media (max-width:420px){
  .row.keepTwo{ gap:8px; }
  label{ font-size:13px; }
}

label { display:grid; gap:6px; font-size:14px; }

input, button {
  padding:10px;
  border-radius:10px;
  border:1px solid #cfd5e1;
  background:#fff;
  cursor:pointer;
}

/* поля времени и UTC-дельты */
input[type="time"], input[type="number"]{
  width:120px;
  font-size:18.5px;
  text-align:center;
  justify-self:start;
}

/* кнопки режима Flight/Cabin */
.modeButtons { display:flex; gap:10px; }
.modeBtn { flex:1; font-weight:600; }
.modeBtn.active { background:#1976d2; color:#fff; border-color:#1976d2; }

/* переключатели */
.toggleBtn { font-weight:600; }

/* анимация Cabin Crew */
#ccBlock {
  overflow:hidden;
  max-height:0;
  opacity:0;
  transform:translateY(-6px);
  transition:max-height 260ms ease, opacity 260ms ease, transform 260ms ease;
}
#ccBlock.open { max-height:220px; opacity:1; transform:translateY(0); }

/* ===== ПОДЛОЖКИ (как pill) для заголовков полей ===== */
.fieldTitle{
  display:inline-block;
  font-size:12px;
  padding:2px 8px;
  border-radius:999px;
  background:#f0f2f7;
  border:1px solid #e6e8ee;
  width: fit-content;
}

/* ===== КНОПКИ ЧАСОВОГО РЕЖИМА (МСК/UTC/Local) ===== */
.tzGroup{
  display:flex;
  gap:8px;
  justify-content:flex-start;
  flex-wrap:nowrap;
}
.tzBtn{
  font-weight:600;
  padding:8px 10px;
  border-radius:10px;
}
.tzBtn.active{
  background:#1976d2;
  color:#fff;
  border-color:#1976d2;
}

/* блок с Δ UTC? появляется только при Local */
#deltaWrap{
  display:none;
  margin-top:8px;
}
#deltaWrap.show{
  display:block;
}

/* ===== РЕЗУЛЬТАТЫ ===== */
.results3{ display:grid; gap:10px; }

/* телефон: 1 сверху по центру, ниже 2 слева/справа */
@media (max-width:639px){
  .results3{ grid-template-columns:1fr 1fr; }
  .results3 .resultBox:first-child{
    grid-column:1 / -1;
    justify-self:center;
  }
}

/* планшет/десктоп */
@media (min-width:640px){
  .results3{ grid-template-columns:1fr 1fr 1fr; }
}

/* выравнивание результатов по горизонтали */
.resultBox{
  text-align:center;
  display:grid;
  grid-template-rows:auto auto;
  align-items:start;
}
.resultBox .out{ align-self:end; }

.ldtBox{ text-align:center; }

.pill{
  display:inline-block;
  font-size:12px;
  padding:2px 8px;
  border-radius:999px;
  background:#f0f2f7;
  border:1px solid #e6e8ee;
  width: fit-content;
  justify-self:center;
}
.out{ font-size:21px; font-weight:700; margin-top:6px; }
</style>
</head>

<body>
<div class="wrap">

<div class="card">
  <h1>Расчет смены</h1>
</div>

<div class="card">
  <!-- СТРОКА: слева 1), справа кнопки МСК/UTC/Local (+ Δ UTC? только при Local) -->
  <div class="row keepTwo">
    <label>
      <span class="fieldTitle">1) Время вылета по расписанию</span>
      <input id="depTime" type="time" value="05:00" step="60">
    </label>

    <div>
      <div class="tzGroup" aria-label="Часовой пояс">
        <button type="button" id="btnMSK" class="tzBtn active" onclick="setTzMode('MSK')">МСК</button>
        <button type="button" id="btnUTC" class="tzBtn" onclick="setTzMode('UTC')">UTC</button>
        <button type="button" id="btnLOCAL" class="tzBtn" onclick="setTzMode('LOCAL')">Local</button>
      </div>

      <div id="deltaWrap">
        <label style="margin-top:0;">
          <span class="fieldTitle">Δ UTC?</span>
          <input id="deltaUtc" type="number" value="0" step="1" inputmode="numeric">
        </label>
      </div>
    </div>
  </div>

  <label style="margin-top:10px;">
    2) Режим расчета
    <div class="modeButtons">
      <button type="button" id="btnFlight" class="modeBtn active" onclick="setCrew('flight')">Flight Crew</button>
      <button type="button" id="btnCabin" class="modeBtn" onclick="setCrew('cabin')">Cabin Crew</button>
    </div>
  </label>

  <!-- 3) и 7) в одной строке на телефоне -->
  <div id="ccBlock" class="row keepTwo" style="margin-top:10px;">
    <label>
      3) Аэропорт явки
      <button type="button" id="airportBtn" class="toggleBtn" onclick="toggleAirport()">UUEE</button>
    </label>
    <label>
      7) Усиленный экипаж?
      <button type="button" id="reinforcedBtn" class="toggleBtn" onclick="toggleReinforced()">Нет</button>
    </label>
  </div>

  <!-- 4) и 5) в одной строке на телефоне -->
  <div class="row keepTwo" style="margin-top:10px;">
    <label>
      4) Кол-во посадок
      <button type="button" id="landingsBtn" class="toggleBtn" onclick="toggleLandings()">1–2</button>
    </label>
    <label>
      5) Продление КВС?
      <button type="button" id="extendBtn" class="toggleBtn" onclick="toggleExtend()">Нет</button>
    </label>
  </div>
</div>

<!-- Результаты -->
<div class="card">
  <div class="results3">
    <div class="resultBox">
      <div class="pill">Продолжительность смены</div>
      <div class="out" id="outDuration">—</div>
    </div>

    <div class="resultBox">
      <div class="pill">Выключение двигателей</div>
      <div class="out" id="outEngOff">—</div>
    </div>

    <div class="resultBox">
      <div class="pill">Окончание смены</div>
      <div class="out" id="outEndShift">—</div>
    </div>
  </div>
</div>

<!-- 6) + LDT -->
<div class="card">
  <div class="row keepTwo">
    <label>
      <span class="fieldTitle">6) Время на обратный полет</span>
      <input id="flightTime" type="time" value="02:30" step="60">
    </label>

    <div class="ldtBox">
      <div class="pill">LDT</div>
      <div class="out" id="outLdt">—</div>
    </div>
  </div>
</div>

</div>

<script>
let cabincrew="нет", airport="UUEE", reinforced="нет", landings="1-2", extend="нет";

/* Новый режим времени (пока НЕ влияет на расчеты, как вы и просили) */
let tzMode = "MSK"; // MSK | UTC | LOCAL

function setTzMode(mode){
  tzMode = mode;

  btnMSK.classList.toggle("active", tzMode==="MSK");
  btnUTC.classList.toggle("active", tzMode==="UTC");
  btnLOCAL.classList.toggle("active", tzMode==="LOCAL");

  if(tzMode==="LOCAL"){
    deltaWrap.classList.add("show");
  } else {
    deltaWrap.classList.remove("show");
    // чтобы не было "скрытого" влияния в будущем — держим 0
    if (typeof deltaUtc !== "undefined" && deltaUtc) deltaUtc.value = "0";
  }

  render();
}

function setCrew(type){
  cabincrew=(type==="cabin")?"да":"нет";
  btnFlight.classList.toggle("active",cabincrew==="нет");
  btnCabin.classList.toggle("active",cabincrew==="да");
  cabincrew==="да"?ccBlock.classList.add("open"):ccBlock.classList.remove("open");
  if(cabincrew==="нет"){
    airport="UUEE"; reinforced="нет";
    airportBtn.textContent="UUEE"; reinforcedBtn.textContent="Нет";
  }
  render();
}

function toggleAirport(){ airport=airport==="UUEE"?"другой":"UUEE"; airportBtn.textContent=airport; render(); }
function toggleReinforced(){ reinforced=reinforced==="нет"?"да":"нет"; reinforcedBtn.textContent=reinforced==="да"?"Да":"Нет"; render(); }
function toggleLandings(){ landings=landings==="1-2"?"3-4":"1-2"; landingsBtn.textContent=landings==="1-2"?"1–2":"3–4"; render(); }
function toggleExtend(){ extend=extend==="нет"?"да":"нет"; extendBtn.textContent=extend==="да"?"Да":"Нет"; render(); }

function parseTime(t){ if(!t) return null; const[a,b]=t.split(":").map(Number); return a*60+b; }
function fmt(m){ m=(m+1440)%1440; return String(Math.floor(m/60)).padStart(2,"0")+":"+String(m%60).padStart(2,"0"); }

function calculate(){
  const dep=parseTime(depTime.value), flt=parseTime(flightTime.value);
  if(dep==null||flt==null) return null;

  // ВАЖНО: tzMode и deltaUtc пока НЕ участвуют в расчетах (логика не меняется)
  // const delta = (tzMode==="LOCAL") ? Number(deltaUtc.value||0) : 0;

  const checkIn=dep-((cabincrew==="да"&&airport==="UUEE")?90:60);
  const isDay=checkIn>=361&&checkIn<=1319;

  let norm=null;
  if(cabincrew==="да"&&reinforced==="да"){
    norm=(landings==="1-2")?(extend==="да"?960:780):(extend==="да"?900:720);
  } else {
    if(landings==="1-2") norm=isDay?(extend==="да"?840:720):(extend==="да"?780:660);
    if(landings==="3-4") norm=isDay?(extend==="да"?750:630):(extend==="да"?720:600);
  }
  if(!norm) return null;

  const end=checkIn+norm;
  return{duration:end-checkIn,eng:end-30,end,ldt:end-30-flt};
}

function render(){
  const r=calculate();
  if(!r){
    outDuration.textContent=outEngOff.textContent=outEndShift.textContent=outLdt.textContent="—";
    return;
  }
  outDuration.textContent=fmt(r.duration);
  outEngOff.textContent=fmt(r.eng);
  outEndShift.textContent=fmt(r.end);
  outLdt.textContent=fmt(r.ldt);
}

/* моментальный пересчет */
let lastDep=depTime.value, lastFlt=flightTime.value;
let lastTz=tzMode, lastDelta="0";

setInterval(()=>{
  const deltaVal = (tzMode==="LOCAL" && deltaWrap.classList.contains("show") && window.deltaUtc) ? deltaUtc.value : "0";
  if(depTime.value!==lastDep || flightTime.value!==lastFlt || tzMode!==lastTz || deltaVal!==lastDelta){
    lastDep=depTime.value; lastFlt=flightTime.value; lastTz=tzMode; lastDelta=deltaVal;
    render();
  }
},150);

/* старт */
ccBlock.classList.remove("open");
setTzMode("MSK");   // по умолчанию МСК (и дельта скрыта)
render();
</script>
</body>
</html>
